/*	Benjamin DELPY `gentilkiwi`
	https://blog.gentilkiwi.com
	benjamin@gentilkiwi.com
	Licence : https://creativecommons.org/licenses/by/4.0/
*/
#pragma once
#include "kuhl_m.h"
#include "../../modules/asn1/kull_m_kerberos_asn1.h"
#include "../../modules/asn1/kull_m_kerberos_asn1_authinfos.h"
#include "../../modules/kull_m_net.h"
#include "kerberos/kuhl_m_kerberos_pac.h"
#include "kerberos/kuhl_m_kerberos.h"
#include <NtDsAPI.h>

const KUHL_M kuhl_m_exploit;

NTSTATUS kuhl_m_exploit_ms14068(int argc, wchar_t * argv[]);
NTSTATUS kuhl_m_exploit_ms11013(int argc, wchar_t * argv[]);
NTSTATUS kuhl_m_exploit_cve20177494(int argc, wchar_t * argv[]);

PWSTR kuhl_m_exploit_ms14068_getname(PCWSTR pre, PCWSTR post);
BOOL kuhl_m_exploit_generic_ms(int argc, wchar_t * argv[], KULL_M_ASN1_TGS_REP **TgsRep, KULL_M_ASN1_EncTGSRepPart **encTgsRepPart, PCWSTR szService, PKIWI_AUTH_INFOS *reuseinfos, PKULL_M_SOCK *reusesocket);
BOOL kuhl_m_exploit_give_pac(int argc, wchar_t * argv[], KULL_M_ASN1_KerberosTime *authtime, PKIWI_AUTH_INFOS infos, PKULL_M_SOCK socket, KULL_M_ASN1__octet1 *pac);

PWSTR kuhl_m_exploit_cve20177494_getDestFilename(LPCWSTR filename, LPCWSTR servername, LPCWSTR share);
PWSTR kuhl_m_exploit_cve20177494_getRemoteLocalFilename(LPCWSTR filename, LPWSTR path);
PWSTR kuhl_m_exploit_cve20177494_getPipeName(LPCWSTR servername, LPCWSTR remotelocalfilename);